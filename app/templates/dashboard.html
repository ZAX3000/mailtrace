<!DOCTYPE html>
<html lang="en">

<head>
  <script>window.MT_CONTEXT = { run_id: '{{ run_id|default('') }}'};</script>
  <!-- Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MailTrace — Modular Dashboard (v19.4)</title>

  <!-- Core CSS (base → components) -->
  <link rel="stylesheet" href="/static/dashboard/css/base.css?v=20251017">
  <link rel="stylesheet" href="/static/dashboard/css/legend.css?v=20251017">
  <link rel="stylesheet" href="/static/dashboard/css/mapper.css?v=20251017">
  <link rel="stylesheet" href="/static/dashboard/css/navbar.css?v=20251017">
  <link rel="stylesheet" href="/static/dashboard/css/dashboard-ui.css?v=1">
  <link rel="stylesheet" href="/static/dashboard/css/dashboard-charts.css?v=1">

  <!-- Theme – includes CTA + modal styles -->
  <link rel="stylesheet" href="/static/dashboard/css/theme.css?v=20251017">

  <!-- Loader CSS (after theme so it can override if needed) -->
  <link rel="stylesheet" href="/static/dashboard/css/loader.css?v=20251017">

  <!-- Page-specific overrides (keep last so they win) -->
  <link rel="stylesheet" href="/static/dashboard/css/page.css?v=20251017">

  <!-- Missing field popup CSS -->
  <link rel="stylesheet" href="/static/dashboard/css/missing-field-popup.css">

  <!-- Include mapper-modal CSS -->
  <link rel="stylesheet" href="/static/dashboard/css/mapper-modal.css">

  <!-- Include mt-legend-navy CSS -->
  <link rel="stylesheet" href="/static/dashboard/css/mt-legend-navy.css">

  <!-- Include dash-mapper-skin CSS -->
  <link rel="stylesheet" href="/static/dashboard/css/dash-mapper-skin.css?v=20251017">
  <link rel="stylesheet" href="/static/dashboard/css/dash-mapper-modal-skin.css?v=20251023">

  <!-- JS (defer so parsing doesn’t block paint) -->
  <script src="/static/dashboard/js/loader.js?v=20251017" defer></script>
  <script src="/static/dashboard/js/loader-center-patch.js?v=20251017" defer></script>
  <script src="/static/dashboard/js/gate.js?v=20251017" defer></script>
  <script src="/static/dashboard/js/theme.js?v=20251017" defer></script>

  <script src="/static/dashboard/js/dashboard-runtime.js?v=20251017" defer></script>

  <script src="/static/dashboard/js/fuzzy-defaults.js?v=20251022" defer></script>
  <script src="/static/dashboard/js/mapper-modal.js?v=20251017" defer></script>

  <script src="/static/dashboard/js/missing-field-popup.js" defer></script>

  <script src="/static/dashboard/js/mtMapper_v12_improveDates.js" defer></script>
  <script src="/static/dashboard/js/mtMapper_v12_hookApply.js" defer></script>
  <script src="/static/dashboard/js/mtMapper_v10_enforce.js?v=20251017" defer></script>

  <script src="/static/dashboard/js/mt-legend-navy.js" defer></script>
  <script src="/static/dashboard/js/advbtn-finder.js" defer></script>
  <script src="/static/dashboard/js/cta-3d-apply.js" defer></script>
  <script src="/static/dashboard/js/csv-validation-popup.js" defer></script>

  <script src="/static/dashboard/js/kpi-graph-renderer.js" defer></script>
  <script src="/static/dashboard/js/kpi-graph-summary.js" defer></script>
  <script src="/static/dashboard/js/kpi-summary-renderer.js" defer></script>
  <script src="/static/dashboard/js/match-upload.js" defer></script>
  <script src="/static/dashboard/js/match-validation-popup.js" defer></script>

  <script src="/static/dashboard/js/linechart.js" defer></script>
  <script src="/static/dashboard/js/yoy-graph-renderer.js" defer></script>
  <script src="/static/dashboard/js/legend-and-mmyy-hook.js?v=20251022" defer></script>
  <script src="/static/dashboard/js/tooltip-enhancer.js" defer></script>

  <script src="/static/dashboard/js/dash-mapper-skin-apply.js?v=20251023" defer></script>
  <script src="/static/dashboard/js/dash-mapper-modal-apply.js?v=20251023" defer></script>
  <script src="/static/dashboard/js/dash-mapper-modal-vars.js?v=20251023" defer></script>
  <script src="/static/dashboard/js/dash-mapper-structure.js?v=1" defer></script>
  <script src="/static/dashboard/js/dash-mapper-actions-apply.js?v=1" defer></script>

</head>

<body>
  {% include "components/navbar.html" %}
  <header>
    <!-- <div class="brand">mailtrace • modular dashboard <span style="font-size:12px;color:#9fb2c8">v19.4</span></div> -->
  </header>
  <div class="wrap">
    <div class="err" id="err"><b>JavaScript error:</b> <span id="errmsg"></span></div>
    <div class="row">
      <div class="card" style="flex:1 1 380px; min-width:340px">
        <label class="small">Mail CSV</label>
        <input accept=".csv" id="mailCsv" type="file" />
        <label class="small">CRM CSV</label>
        <input accept=".csv" id="crmCsv" type="file" />
        <button id="runBtn">Run matching</button>


      </div>
      <div class="card row" id="cmp-kpis"
        style="flex:3 1 520px; min-width:320px; align-items:center; justify-content:space-around">
        <div class="kpi">
          <div class="v" data-kpi="mail"></div>
          <div class="l">Total Mail</div>
        </div>
        <div class="kpi">
          <div class="v" data-kpi="uniqmail"></div>
          <div class="l">Unique Mail Addresses</div>
        </div>
        <div class="kpi">
          <div class="v" data-kpi="crm"></div>
          <div class="l">Total Jobs</div>
        </div>
        <div class="kpi">
          <div class="v" data-kpi="matches"></div>
          <div class="l">Matches</div>
        </div>
        <div class="kpi">
          <div class="v" data-kpi="rate"></div>
          <div class="l">Match Rate</div>
        </div>
        <div class="kpi">
          <div class="v" data-kpi="revenue"></div>
          <div class="l">Match Revenue</div>
        </div>
      </div>
    </div>
    <div class="section card" id="cmp-graph">
      <div class="yoy yoy-btn">
        <label><input id="yoyToggle" type="checkbox" checked> Show YoY overlay</label>
      </div>
      <canvas id="chart" width="1000" height="260"></canvas>
    </div>
    <div class="row section" id="cmp-top">
      <div class="card" style="flex:1 1 360px">
        <div style="font-weight:600;margin-bottom:8px">Top Cities</div>
        <div class="table-wrap topwrap">
          <table data-kind="cities">
            <thead>
              <tr>
                <th>City</th>
                <th style="text-align:center">Total Matches</th>
                <th style="text-align:center">Match Rate</th>
              </tr>
            </thead>
            <tbody data-top="cities"></tbody>
          </table>
        </div>
      </div>
      <div class="card" style="flex:1 1 360px">
        <div style="font-weight:600;margin-bottom:8px">Top ZIPs</div>
        <div class="table-wrap topwrap">
          <table data-kind="zips">
            <thead>
              <tr>
                <th>ZIP</th>
                <th style="text-align:center">Total Matches</th>
                <th style="text-align:center">Match Rate</th>
              </tr>
            </thead>
            <tbody data-top="zips"></tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="section card" id="cmp-summary">
      <div style="font-weight:600;margin-bottom:8px">Summary</div>
      <div class="table-wrap">
        <table>
          <colgroup id="sum-cols"></colgroup>
          <thead>
            <tr>
              <th>Mail Address 1</th>
              <th>Mail Unit</th>
              <th>CRM Address 1</th>
              <th>CRM Unit</th>
              <th>City</th>
              <th>State</th>
              <th>ZIP</th>
              <th>Mail Dates</th>
              <th>CRM Date</th>
              <th>Amount</th>
              <th>Confidence</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody data-summary="rows"></tbody>
        </table>
      </div>
    </div>
  </div>
  <div aria-hidden="true" id="mtMapperOverlay">
    <div aria-labelledby="mtMapperTitle" aria-modal="true" id="mtMapperModal" role="dialog">
      <header>
        <h3 id="mtMapperTitle">Map your columns</h3>
        <button class="btn ghost" id="mtMapperClose">Close</button>
      </header>
      <div class="body">
        <p id="mtMapperHelp">We couldn't automatically detect some columns. Map the fields below and we'll remember them
          for next time.</p>
        <div class="grid">
          <div class="col" id="mtMapMail">
            <h4>Mail CSV</h4>
            <div class="rows"></div>
          </div>
          <div class="col" id="mtMapCRM">
            <h4>CRM CSV</h4>
            <div class="rows"></div>
          </div>
        </div>
      </div>
      <footer>
        <button class="btn ghost" id="mtMapperAuto">Auto‑map</button>
        <div style="flex:1"></div>
        <button class="btn" id="mtMapperCancel">Cancel</button>
        <button class="btn primary" id="mtMapperApply">Use mapping</button>
      </footer>
    </div>
  </div>
  <!-- v9 popup -->
  <div aria-hidden="true" id="mtPopupOverlay">
    <div aria-labelledby="mtPopupTitle" aria-modal="true" id="mtPopup" role="alertdialog">
      <header>
        <h3 id="mtPopupTitle">Missing required mappings</h3>
        <button class="btn" id="mtPopupClose" title="Close">Close</button>
      </header>
      <div class="body">
        <p>We couldn’t proceed because the following required fields aren’t mapped yet:</p>
        <ul id="mtPopupList"></ul>
      </div>
      <footer>
        <button class="btn primary" id="mtPopupOk">OK—take me back</button>
      </footer>
    </div>
  </div>
  <div aria-labelledby="mt-modal-title" aria-modal="true" id="mt-modal-backdrop" role="dialog" style="display:none">
    <div aria-describedby="mt-modal-desc" id="mt-modal" role="document" tabindex="-1">
      <header>
        <span aria-hidden="true" class="dot"></span>
        <h3 id="mt-modal-title">Action needed</h3>
      </header>
      <div class="content">
        <p id="mt-modal-desc">Please pick <strong>both CSV files</strong> first.</p>
        <p class="hint">Tip: select your <em>Mail CSV</em> and your <em>CRM CSV</em>, then click <strong>Run
            matching</strong>.</p>
      </div>
      <footer>
        <button class="btn btn-outline" id="mt-modal-cancel" type="button">Cancel</button>
        <button class="btn btn-primary" id="mt-modal-ok" type="button">Okay</button>
      </footer>
    </div>
  </div>

  <script src="/static/dashboard/js/progress_wiring.js?v=20251017" defer></script>

</body>

</html>
<!-- MailTrace SSOT section versions: {"baseline": "v19.4", "sections": {"summary": "s1.11", "graph": "g1.9", "kpis": "k1.5", "topMail": "t1.6", "input": "i1.0", "logic": "m1.1"}, "locked_on": "2025-09-17", "note": "KPIs: RPM, Avg Ticket, Median Days, \u226430/60/90, Unique Mail Addresses; advanced KPIs collapsible inside KPI box (3-across grid). Labels updated (Total Jobs). Controls hidden; Strictness default Loose."} -->
<script>window.MailTraceSectionVersions = { "baseline": "v19.4", "sections": { "summary": "s1.11", "graph": "g1.9", "kpis": "k1.5", "topMail": "t1.6", "input": "i1.0", "logic": "m1.1" }, "locked_on": "2025-09-17", "note": "KPIs: RPM, Avg Ticket, Median Days, \u226430/60/90, Unique Mail Addresses; advanced KPIs collapsible inside KPI box (3-across grid). Labels updated (Total Jobs). Controls hidden; Strictness default Loose." };</script>